/*!
 *	HMT Bus GO -- 华农校巴查询程序
 *
 *	@author CRH380A-2722 <609657831@qq.com>
 *	@copyright 2016-2017 CRH380A-2722
 *	@license MIT
 *	@note 通用JavaScript
 */
(function(g){var l="";var h="";var j="";var q=0;var p=0;var o,d;var k;function f(){g("#stopName").autocomplete({source:"./ajax/ajax.StopName.php"});NProgress.configure({showSpinner:false,parent:"#progress-embeded"});g("#device-refresh-btn").on("click",function(r){g("#device-refresh-btn").html("刷新中...");g("#device-refresh-btn").addClass("disabled");g("#loader").fadeIn("fast");NProgress.start();e()});g("#device-auto-refresh-btn").on("click",function(r){m()});g("#stop-refresh-btn").on("click",function(r){k=g("#line-id").val();g("#stop-refresh-btn").html("刷新中...");g("#stop-refresh-btn").addClass("disabled");g("#loader").fadeIn("fast");NProgress.start();n()});g("#stop-auto-refresh-btn").on("click",function(r){c()})}function e(){l="";h="";g.get("./ajax/ajax.GetDevice.php",function(r){for(a=0;a<r["ONLINE"].length;a++){l+='<div class="col-sm-6"><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title"><span class="fa fa-bus"></span> '+r["ONLINE"][a]["BUS_NUM"]+'</h3></div><ul class="list-group"><li class="list-group-item"><strong>终端状态:</strong> <span class="text-success">在线</span></li><li class="list-group-item"><strong>执行线路:</strong> '+r["ONLINE"][a]["LINE_NAME"]+'</li><li class="list-group-item"><strong>当前站:</strong> '+r["ONLINE"][a]["CURRENT_STOP_NAME"]+'</li><li class="list-group-item"><strong>下一站:</strong> '+r["ONLINE"][a]["NEXT_STOP_NAME"]+'</li><li class="list-group-item"><strong>GPS最后更新时间:</strong> '+r["ONLINE"][a]["UPDATE_TIME"]+"</li></ul></div></div>"}for(b=0;b<r["OFFLINE"].length;b++){h+='<div class="col-sm-6"><div class="panel panel-danger"><div class="panel-heading"><h3 class="panel-title"><span class="fa fa-bus"></span> '+r["OFFLINE"][b]["BUS_NUM"]+'</h3></div><ul class="list-group"><li class="list-group-item"><strong>终端状态:</strong> <span class="text-danger">离线</span></li><li class="list-group-item"><strong>GPS最后更新时间:</strong> '+r["OFFLINE"][b]["UPDATE_TIME"]+"</li></ul></div></div>"}g("#online-list").html(l);g("#offline-list").html(h);g("#device-refresh-btn").html('<span class="fa fa-refresh"></span> 刷新数据');g("#device-refresh-btn").removeClass("disabled");g("#loader").fadeOut("fast");NProgress.done()})}function m(){setTimeout(function(){if(g("#auto-refresh-flag").prop("checked")){g("#status").html("ON");g("#auto-refresh-logo").addClass("fa-spin");q=1}else{g("#status").html("OFF");g("#auto-refresh-logo").removeClass("fa-spin");q=0}if(q){o=setInterval(function(){g("#device-refresh-btn").addClass("disabled");g("#device-refresh-btn").html("刷新中...");g("#loader").fadeIn("fast");NProgress.start();e()},15000)}else{clearInterval(o)}},5)}function n(){j="";g.post("./ajax/ajax.GetStop.php",{lineId:k},function(r){for(i=0;i<r.length;i++){j+='<a href="./index.php?mod=stopinfo&id='+r[i]["stop_id"]+'" class="list-group-item">';if(r[i]["have_bus"]){j+='<span class="badge"><span class="fa fa-bus"></span> '+r[i]["have_bus"]+"</span>"}j+='<span class="fa fa-map-marker"></span> '+r[i]["stop_name"]+"</a>"}g("#stop-list").html(j);g("#stop-refresh-btn").html('<span class="fa fa-refresh"></span> 刷新数据');g("#stop-refresh-btn").removeClass("disabled");g("#loader").fadeOut("fast");NProgress.done()})}function c(){setTimeout(function(){if(g("#auto-refresh-flag").prop("checked")){g("#status").html("ON");g("#auto-refresh-logo").addClass("fa-spin");p=1}else{g("#status").html("OFF");g("#auto-refresh-logo").removeClass("fa-spin");p=0}if(p){d=setInterval(function(){g("#stop-refresh-btn").addClass("disabled");g("#stop-refresh-btn").html("刷新中...");g("#loader").fadeIn("fast");NProgress.start();n()},15000)}else{clearInterval(d)}},5)}g(document).ready(function(){f();g(document).pjax('a[data-pjax!="no-pjax"]',"#pjax",{fragment:"#pjax",timeout:60000});g(document).on("submit","#stopSearch",function(r){g.pjax.submit(r,"#pjax",{fragment:"#pjax",timeout:60000})});g(document).on("pjax:send",function(){clearInterval(o);clearInterval(d);g("#loader").fadeIn("fast");g("#navbar-collapse").collapse({toggle:false});g("#navbar-collapse").collapse("hide");NProgress.start()});g(document).on("pjax:complete",function(){g("body,html").animate({scrollTop:0},0);g("#loader").fadeOut("fast");NProgress.done();f()})})})(jQuery);